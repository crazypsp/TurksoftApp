@{
    ViewData["Title"] = "Giden e-Müstahsil";
    ViewData["Subtitle"] = "e-Müstahsil";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<section class="content-header">
    <h1>e-Müstahsil <small>Giden e-Müstahsil</small></h1>
    <ol class="breadcrumb">
        <li><a asp-controller="Home" asp-action="Index"><i class="fa fa-home"></i></a> e-Müstahsil</li>
        <li class="active">Giden e-Müstahsil</li>
    </ol>
</section>

<section class="content">
    <h2>Giden e-Müstahsil Listesi</h2>

    <div class="box box-default">
        <div class="box-body">
            <div class="row">
                <div class="col-md-3">
                    <div class="form-horizontal row">
                        <label class="control-label col-sm-4">Başlangıç Tarihi</label>
                        <div class="col-sm-8">
                            <div class="input-group">
                                <div class="input-group-addon"><i class="fa fa-calendar"></i></div>
                                <input type="text" id="startDate" class="form-control datepicker" placeholder="GG.AA.YYYY" />
                            </div>
                        </div>
                    </div>

                    <div class="form-horizontal row">
                        <label class="control-label col-sm-4">Bitiş Tarihi</label>
                        <div class="col-sm-8">
                            <div class="input-group">
                                <div class="input-group-addon"><i class="fa fa-calendar"></i></div>
                                <input type="text" id="endDate" class="form-control datepicker" placeholder="GG.AA.YYYY" />
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-md-3">
                    <div class="form-horizontal row">
                        <label class="control-label col-sm-4">Senaryo</label>
                        <div class="col-sm-8">
                            <select id="senaryo" class="form-control select2">
                                <option value="">Tümü</option>
                                <option value="TEMEL">Temel</option>
                                <option value="TICARI">Ticari</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-horizontal row">
                        <label class="control-label col-sm-4">Durum</label>
                        <div class="col-sm-8">
                            <select id="durum" class="form-control select2">
                                <option value="">Tümü</option>
                                <option value="GONDERILDI">Gönderildi</option>
                                <option value="HAZIRLANIYOR">Hazırlanıyor</option>
                                <option value="HATALI">Hatalı</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="col-md-3">
                    <div class="form-horizontal row">
                        <label class="control-label col-sm-4">Mükellef VKN</label>
                        <div class="col-sm-8">
                            <input type="text" id="vkn" class="form-control" placeholder="VKN/TCKN giriniz" maxlength="11" />
                        </div>
                    </div>

                    <div class="form-horizontal row">
                        <label class="control-label col-sm-4">Mükellef Adı</label>
                        <div class="col-sm-8">
                            <input type="text" id="mukellefAdi" class="form-control" placeholder="Firma adı" />
                        </div>
                    </div>
                </div>

                <div class="col-md-3 text-right">
                    <button type="button" class="btn btn-success" onclick="ara()">
                        <i class="fa fa-search"></i> Arama Yap
                    </button>
                    <button type="button" class="btn btn-danger" onclick="temizle()">
                        <i class="fa fa-eraser"></i> Temizle
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div class="box box-primary">
        <div class="box-header with-border">
            <h3 class="box-title">Giden e-Müstahsil Listesi</h3>
        </div>

        <div class="box-body table-responsive">
            <table id="grid_outbox_mustahsil" class="table table-bordered table-hover dataTable dt-head-center">
                <thead>
                    <tr>
                        <th><input type="checkbox" id="selectAll" /></th>
                        <th>e-Müstahsil No</th>
                        <th>VKN / TCKN</th>
                        <th>Unvan</th>
                        <th>Senaryo</th>
                        <th>Belge Tarihi</th>
                        <th>Belge Tutarı</th>
                        <th>Durum</th>
                        <th>İşlemler</th>
                    </tr>
                </thead>

                <tbody>
                    <tr>
                        <td><input type="checkbox" /></td>
                        <td>EMUS20250001</td>
                        <td>12345678901</td>
                        <td>Örnek Mükellef A.Ş.</td>
                        <td>Ticari</td>
                        <td>01.10.2025</td>
                        <td>4.850,00 ₺</td>
                        <td><span class="label label-success">Gönderildi</span></td>
                        <td class="text-center">
                            <button class="btn btn-info btn-sm" title="Görüntüle"><i class="fa fa-eye"></i></button>
                            <button class="btn btn-warning btn-sm" title="Yazdır"><i class="fa fa-print"></i></button>
                            <button class="btn btn-danger btn-sm" title="Sil"><i class="fa fa-trash"></i></button>
                        </td>
                    </tr>

                    <tr>
                        <td><input type="checkbox" /></td>
                        <td>EMUS20250002</td>
                        <td>78945612300</td>
                        <td>Demir Gıda Ltd. Şti.</td>
                        <td>Temel</td>
                        <td>02.10.2025</td>
                        <td>2.340,00 ₺</td>
                        <td><span class="label label-warning">Hazırlanıyor</span></td>
                        <td class="text-center">
                            <button class="btn btn-info btn-sm" title="Görüntüle"><i class="fa fa-eye"></i></button>
                            <button class="btn btn-warning btn-sm" title="Yazdır"><i class="fa fa-print"></i></button>
                            <button class="btn btn-danger btn-sm" title="Sil"><i class="fa fa-trash"></i></button>
                        </td>
                    </tr>

                    <tr>
                        <td><input type="checkbox" /></td>
                        <td>EMUS20250003</td>
                        <td>6321250052</td>
                        <td>Nox Yazılım Hizmetleri Ltd. Şti.</td>
                        <td>Ticari</td>
                        <td>03.10.2025</td>
                        <td>7.250,00 ₺</td>
                        <td><span class="label label-danger">Hatalı</span></td>
                        <td class="text-center">
                            <button class="btn btn-info btn-sm" title="Görüntüle"><i class="fa fa-eye"></i></button>
                            <button class="btn btn-warning btn-sm" title="Yazdır"><i class="fa fa-print"></i></button>
                            <button class="btn btn-danger btn-sm" title="Sil"><i class="fa fa-trash"></i></button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="box-footer">
            <button type="button" class="btn btn-success" onclick="topluGonderim()">
                <i class="fa fa-paper-plane"></i> Seçili Kayıtları Gönder
            </button>
            <button type="button" class="btn btn-danger" onclick="seciliSil()">
                <i class="fa fa-trash"></i> Seçili Kayıtları Sil
            </button>
        </div>
    </div>
    <!-- Görüntüleme Modal -->
    <div class="modal fade" id="modalGoster" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header bg-blue">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title"><i class="fa fa-file-text"></i> e-Müstahsil Görüntüle</h4>
                </div>
                <div class="modal-body">
                    <iframe id="iframeGoster" style="border:0;width:100%;height:500px;"></iframe>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-default pull-right" data-dismiss="modal">Kapat</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Silme Onay Modal -->
    <div class="modal fade" id="modalSilOnay" tabindex="-1" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-red">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title"><i class="fa fa-trash"></i> Silme Onayı</h4>
                </div>
                <div class="modal-body">
                    <p>Seçili e-Müstahsil kaydını silmek istediğinize emin misiniz?</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Vazgeç</button>
                    <button type="button" class="btn btn-danger" id="btnSilOnay">Evet, Sil</button>
                </div>
            </div>
        </div>
    </div>
</section>

@section Scripts {
    <script>
        $(function () {
            // DataTable başlat
            $('#grid_outbox_mustahsil').DataTable({
                "language": {
                    "url": "//cdn.datatables.net/plug-ins/1.10.21/i18n/Turkish.json"
                },
                "pageLength": 10,
                "ordering": true,
                "columnDefs": [
                    { "orderable": false, "targets": [0, 8] }
                ]
            });

            // Select2 ve DatePicker aktif et
            $('.select2').select2();
            $('.datepicker').datepicker({
                autoclose: true,
                language: 'tr',
                format: 'dd.mm.yyyy'
            });
        });

        // Toplu Gönderim
        function topluGonderim() {
            Swal.fire({
                title: 'Toplu Gönderim',
                text: 'Seçili kayıtlar gönderilecektir. Emin misiniz?',
                icon: 'question',
                showCancelButton: true,
                confirmButtonText: 'Evet, Gönder',
                cancelButtonText: 'İptal'
            }).then((result) => {
                if (result.isConfirmed)
                    Swal.fire('Gönderildi!', 'Kayıtlar başarıyla gönderildi.', 'success');
            });
        }

        // Toplu Silme
        function seciliSil() {
            const secili = $('#grid_outbox_mustahsil tbody input[type="checkbox"]:checked').length;
            if (secili === 0) {
                Swal.fire('Uyarı', 'Lütfen silinecek kayıtları seçiniz.', 'warning');
                return;
            }

            Swal.fire({
                title: 'Toplu Silme',
                text: secili + ' kayıt silinecektir. Onaylıyor musunuz?',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'Evet, Sil',
                cancelButtonText: 'İptal'
            }).then((result) => {
                if (result.isConfirmed)
                    Swal.fire('Silindi', 'Seçili kayıtlar başarıyla silindi.', 'success');
            });
        }

        // Tekil işlemler
        function ara() {
            Swal.fire('Bilgi', 'Filtreye göre arama işlemi gerçekleştirildi.', 'info');
        }

        function temizle() {
            $('input').val('');
            $('.select2').val('').trigger('change');
            Swal.fire('Temizlendi', 'Tüm filtre alanları sıfırlandı.', 'success');
        }

        // Görüntüle butonu örnek
        $(document).on('click', '.btn-info', function () {
            $('#iframeGoster').attr('src', '/Uploads/eMustahsil/OrnekFatura.pdf');
            $('#modalGoster').modal('show');
        });

        // Silme butonu örnek
        $(document).on('click', '.btn-danger', function () {
            $('#modalSilOnay').modal('show');
        });

        $('#btnSilOnay').on('click', function () {
            $('#modalSilOnay').modal('hide');
            Swal.fire('Silindi', 'e-Müstahsil kaydı silindi.', 'success');
        });
    </script>
}
