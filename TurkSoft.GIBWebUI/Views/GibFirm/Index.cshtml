@{
    ViewData["Title"] = "Firmalar";
    ViewData["Subtitle"] = "GİB Firmaları";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers

@section Styles {
    <style>
        /* ==== Kurumsal Modal Tasarımı (GİB Firma) ==== */

        .modal-corporate .modal-header {
            background: linear-gradient(90deg, #3c8dbc, #00a65a);
            color: #fff;
            border-bottom: none;
            padding: 14px 20px;
        }

        .modal-corporate .modal-title {
            font-weight: 600;
            font-size: 16px;
            letter-spacing: .02em;
        }

        .modal-corporate .modal-header .close {
            color: #fff;
            opacity: .8;
            text-shadow: none;
        }

            .modal-corporate .modal-header .close:hover {
                opacity: 1;
            }

        .modal-corporate .modal-body {
            padding: 20px 24px 18px;
            background-color: #f9fafb;
        }

        .modal-corporate .modal-footer {
            background-color: #f5f7fa;
            border-top: 1px solid #e1e5ee;
            padding: 10px 20px;
        }

        /* Form elemanları */
        .modal-corporate .form-group {
            margin-bottom: 10px;
        }

        .modal-corporate label {
            font-size: 13px;
            font-weight: 500;
            color: #4b4f56;
            margin-bottom: 4px;
        }

        .modal-corporate .form-control {
            border-radius: 3px;
            border-color: #d2d6de;
            box-shadow: none;
            font-size: 13px;
        }

            .modal-corporate .form-control:focus,
            .modal-corporate textarea.form-control:focus {
                border-color: #3c8dbc;
                box-shadow: 0 0 0 1px rgba(60, 141, 188, .25);
            }

        .modal-corporate textarea.form-control {
            resize: vertical;
        }

        .modal-corporate .checkbox {
            margin-top: 4px;
            margin-bottom: 4px;
        }

            .modal-corporate .checkbox label {
                font-weight: 400;
                color: #555;
            }

        .modal-corporate .help-block {
            margin-top: 4px;
            margin-bottom: 0;
            font-size: 11px;
            color: #9ea3b0;
        }

        .modal-corporate .section-title {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: .08em;
            color: #9ea3b0;
            font-weight: 600;
            margin: 0 0 6px;
            padding-bottom: 4px;
            border-bottom: 1px solid #e6e9f0;
        }

            .modal-corporate .section-title i {
                margin-right: 4px;
                color: #3c8dbc;
            }

        .modal-corporate .m-t-20 {
            margin-top: 20px;
        }

        @@media (min-width: 992px) {
            .modal-dialog.modal-lg {
                width: 1024px;
            }
        }

        /* İç gridler */
        .panel-sky {
            background: transparent;
            border: none;
        }

            .panel-sky .panel-body {
                padding: 0;
            }

        .dt-head-center thead th {
            text-align: center;
        }
    </style>
}

<div class="box">
    <div class="box-header with-border">
        <button id="btnNewFirm" class="btn btn-primary">
            <i class="fa fa-plus"></i> Yeni Firma
        </button>
    </div>
    <div class="box-body">
        <table id="tblGibFirms" class="table table-striped table-bordered" style="width:100%">
            <thead>
                <tr>
                    <th>Ünvan</th>
                    <th>VKN/TCKN</th>
                    <th>GİB Alias</th>
                    <th>E-Fatura</th>
                    <th>E-Arşiv</th>
                    <th style="width:130px;">İşlemler</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>

<div id="gibFirmModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="gibFirmModalLabel">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content modal-corporate">
            <form id="gibFirmForm" method="post" novalidate>
                @Html.AntiForgeryToken()

                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Kapat">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <h4 class="modal-title" id="gibFirmModalLabel">
                        <i class="fa fa-building-o"></i> Yeni Firma
                    </h4>
                </div>

                <div class="modal-body">
                    <input type="hidden" id="FirmId" name="Id" />
                    <input type="hidden" id="RowVersionBase64" name="RowVersionBase64" />

                    <ul class="nav nav-tabs" id="gibFirmTabs">
                        <li class="active">
                            <a href="#tabFirmMain" data-toggle="tab">
                                <i class="fa fa-info-circle"></i> Firma Bilgileri
                            </a>
                        </li>
                        <li>
                            <a href="#tabFirmServices" data-toggle="tab">
                                <i class="fa fa-exchange"></i> Hizmet &amp; Alias
                            </a>
                        </li>
                    </ul>

                    <div class="tab-content" style="margin-top:15px;">

                        <div class="tab-pane fade in active" id="tabFirmMain">

                            <div class="section-title">
                                <i class="fa fa-id-card-o"></i> Firma Bilgileri
                            </div>

                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label for="TaxNo">VKN / TCKN *</label>
                                        <input class="form-control" id="TaxNo" name="TaxNo" maxlength="20" />
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label for="CustomerName">Müşteri Adı *</label>
                                        <input class="form-control" id="CustomerName" name="CustomerName" maxlength="200" />
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label for="Title">Unvan *</label>
                                        <input class="form-control" id="Title" name="Title" maxlength="200" />
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label for="KepAddress">Kep Adresi</label>
                                        <input type="email" class="form-control" id="KepAddress" name="KepAddress" placeholder="x@hs0.kep.tr" maxlength="200" />
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label for="PersonalFirstName">Adı (*Tckn)</label>
                                        <input class="form-control" id="PersonalFirstName" name="PersonalFirstName" maxlength="100" />
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label for="InstitutionType">Kurum Türü *</label>
                                        <select class="form-control" id="InstitutionType" name="InstitutionType">
                                            <option value="1">ÖZEL</option>
                                            <option value="0">KAMU</option>
                                            <option value="3">VUK 507 ÖZEL</option>
                                            <option value="2">VUK 507 KAMU</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label for="PersonalLastName">Soyadı (*Tckn)</label>
                                        <input class="form-control" id="PersonalLastName" name="PersonalLastName" maxlength="100" />
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label for="CorporateEmail">Kurumsal e-Posta *</label>
                                        <input type="email" class="form-control" id="CorporateEmail" name="CorporateEmail" maxlength="200" />
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label for="TaxOfficeProvince">Vergi Dairesi İl *</label>
                                        <input class="form-control" id="TaxOfficeProvince" name="TaxOfficeProvince" maxlength="100" />
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label for="TaxOffice">Vergi Dairesi *</label>
                                        <input class="form-control" id="TaxOffice" name="TaxOffice" maxlength="100" />
                                    </div>
                                </div>
                            </div>

                            <!-- ✅ EKLENDİ: REQUIRED alanlar -->
                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label for="CommercialRegistrationNo">Ticaret Sicil No *</label>
                                        <input class="form-control" id="CommercialRegistrationNo" name="CommercialRegistrationNo" maxlength="100" />
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label for="MersisNo">Mersis No *</label>
                                        <input class="form-control" id="MersisNo" name="MersisNo" maxlength="100" />
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label for="CustomerRepresentative">Müşteri Temsilcisi *</label>
                                        <input class="form-control" id="CustomerRepresentative" name="CustomerRepresentative" maxlength="200" />
                                    </div>
                                </div>
                            </div>

                            <hr />

                            <div class="section-title">
                                <i class="fa fa-user"></i> Sorumlu Kişi
                            </div>

                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label for="ResponsibleTckn">Sorumlu Tckn *</label>
                                        <input class="form-control" id="ResponsibleTckn" name="ResponsibleTckn" maxlength="11" />
                                    </div>
                                </div>
                                <div class="col-sm-6"></div>
                            </div>

                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label for="ResponsibleFirstName">Sorumlu Adı *</label>
                                        <input class="form-control" id="ResponsibleFirstName" name="ResponsibleFirstName" maxlength="100" />
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label for="ResponsibleLastName">Sorumlu Soyadı *</label>
                                        <input class="form-control" id="ResponsibleLastName" name="ResponsibleLastName" maxlength="100" />
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label for="ResponsibleMobilePhone">Sorumlu Cep Tel. *</label>
                                        <input class="form-control" id="ResponsibleMobilePhone" name="ResponsibleMobilePhone" maxlength="30" placeholder="___ ___-__-__" />
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label for="ResponsibleEmail">Sorumlu e-Posta *</label>
                                        <input type="email" class="form-control" id="ResponsibleEmail" name="ResponsibleEmail" maxlength="200" />
                                    </div>
                                </div>
                            </div>

                            <hr />

                            <label>Müşteri Kaydını Alan Kişinin:</label>
                            <div class="row">
                                <div class="col-sm-4">
                                    <div class="form-group">
                                        <label for="CreatedByPersonFirstName">Adı *</label>
                                        <input class="form-control" id="CreatedByPersonFirstName" name="CreatedByPersonFirstName" maxlength="100" />
                                    </div>
                                </div>
                                <div class="col-sm-4">
                                    <div class="form-group">
                                        <label for="CreatedByPersonLastName">Soyadı *</label>
                                        <input class="form-control" id="CreatedByPersonLastName" name="CreatedByPersonLastName" maxlength="100" />
                                    </div>
                                </div>
                                <div class="col-sm-4">
                                    <div class="form-group">
                                        <label for="CreatedByPersonMobilePhone">Cep No *</label>
                                        <input class="form-control" id="CreatedByPersonMobilePhone" name="CreatedByPersonMobilePhone" maxlength="30" placeholder="___ ___-__-__" />
                                    </div>
                                </div>
                            </div>

                            <hr />

                            <div class="section-title">
                                <i class="fa fa-map-marker"></i> Adres &amp; İletişim
                            </div>

                            <div class="form-group">
                                <label for="AddressLine">Adres</label>
                                <textarea class="form-control" id="AddressLine" name="AddressLine" rows="3"></textarea>
                            </div>

                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label for="City">Şehir</label>
                                        <input class="form-control" id="City" name="City" maxlength="100" />
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label for="District">İlçe</label>
                                        <input class="form-control" id="District" name="District" maxlength="100" />
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label for="Country">Ülke</label>
                                        <input class="form-control" id="Country" name="Country" maxlength="100" />
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label for="PostalCode">Posta Kodu</label>
                                        <input class="form-control" id="PostalCode" name="PostalCode" maxlength="20" />
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label for="Phone">Telefon</label>
                                        <input class="form-control" id="Phone" name="Phone" maxlength="50" />
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label for="FirmEmail">Genel E-Posta</label>
                                        <input type="email" class="form-control" id="FirmEmail" name="Email" maxlength="200" />
                                    </div>
                                </div>
                            </div>

                            <div class="section-title m-t-20">
                                <i class="fa fa-file-text-o"></i> E-Dönüşüm
                            </div>

                            <div class="checkbox">
                                <label>
                                    <input type="checkbox" id="IsEInvoiceRegistered" name="IsEInvoiceRegistered" />
                                    E-Fatura Mükellefi
                                </label>
                            </div>
                            <div class="checkbox">
                                <label>
                                    <input type="checkbox" id="IsEArchiveRegistered" name="IsEArchiveRegistered" />
                                    E-Arşiv Mükellefi
                                </label>
                            </div>

                            <div class="section-title m-t-20">
                                <i class="fa fa-key"></i> GİB ve Kontör
                            </div>

                            <div class="form-group">
                                <label for="GibAlias">Genel GİB Alias</label>
                                <input class="form-control" id="GibAlias" name="GibAlias" maxlength="200" />
                            </div>

                            <div class="form-group">
                                <label for="ApiKey">API Key</label>
                                <input class="form-control" id="ApiKey" name="ApiKey" maxlength="200" />
                            </div>

                            <div class="form-group">
                                <label for="InitialCredits">
                                    Başlangıç Kontör Miktarı
                                    <span class="text-muted small">(GibUserCreditAccount.TotalCredits)</span>
                                </label>
                                <input type="number" min="0" class="form-control" id="InitialCredits" />
                                <p class="help-block small">
                                    Sadece yeni firma kaydında kullanılır. Güncellemede dokunulmaz.
                                </p>
                            </div>
                        </div>

                        <div class="tab-pane fade" id="tabFirmServices">
                            <div class="section-title">
                                <i class="fa fa-file-text-o"></i> Hizmet Bilgileri
                            </div>

                            <div class="form-group-12">
                                <div class="panel panel-sky">
                                    <div class="panel-body">
                                        <div class="modal-header" style="padding:8px 0 10px;border-bottom:none;">
                                            <button type="button" id="btnNewFirmService" class="btn btn-success">
                                                Hizmet Ekle &nbsp;<span class="btn-label"><i class="glyphicon glyphicon-plus"></i></span>
                                            </button>
                                        </div>
                                        <table id="FirmServiceGrid" class="table table-bordered table-hover dataTable dt-head-center" style="width:100%">
                                            <thead>
                                                <tr>
                                                    <th style="min-width:140px;max-width:180px;text-align:center;">Hizmet Türü</th>
                                                    <th style="min-width:140px;max-width:140px;text-align:center;">Başlangıç Tarihi</th>
                                                    <th style="min-width:140px;max-width:140px;text-align:center;">Bitiş Tarihi</th>
                                                    <th style="min-width:120px;max-width:140px;text-align:center;">Tarife Türü</th>
                                                    <th style="min-width:100px;max-width:120px;text-align:center;">Durum</th>
                                                    <th style="min-width:150px;max-width:180px;text-align:center;">İşlemler</th>
                                                </tr>
                                            </thead>
                                            <tbody></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>

                            <div class="section-title m-t-20">
                                <i class="fa fa-at"></i> Alias Bilgileri
                            </div>

                            <div class="form-group-12">
                                <div class="panel panel-sky">
                                    <div class="panel-body">
                                        <div class="modal-header" style="padding:8px 0 10px;border-bottom:none;">
                                            <button type="button" id="btnNewFirmServiceAlias" class="btn btn-success">
                                                Alias Ekle &nbsp;<span class="btn-label"><i class="glyphicon glyphicon-plus"></i></span>
                                            </button>
                                            <span class="help-block small" style="margin-left:10px;">
                                                Aliaslar, yukarıdaki listeden seçili hizmet için geçerlidir.
                                            </span>
                                        </div>
                                        <table id="FirmServiceAliasGrid" class="table table-bordered table-hover dataTable dt-head-center" style="width:100%">
                                            <thead>
                                                <tr>
                                                    <th style="min-width:140px;max-width:180px;text-align:center;">Hizmet Türü</th>
                                                    <th style="min-width:120px;max-width:120px;text-align:center;">Yön</th>
                                                    <th style="min-width:220px;max-width:260px;text-align:center;">Alias</th>
                                                    <th style="min-width:150px;max-width:180px;text-align:center;">İşlemler</th>
                                                </tr>
                                            </thead>
                                            <tbody></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>

                        </div>

                    </div>
                </div>

                <div class="modal-footer">
                    <button id="btnSaveFirm" type="submit" class="btn btn-success">
                        <i class="fa fa-save"></i> Kaydet
                    </button>
                    <button type="button" class="btn btn-default" data-dismiss="modal">Kapat</button>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <script type="module" src="~/apps/gibFirm.js?v=20251212_3"></script>
}
