@{
    ViewData["Title"] = "Tevkifat Kodları";
    ViewData["Subtitle"] = "Listeler";
    Layout = "~/Views/Shared/_Layout.cshtml";
}


@section Styles{
        <style>
            .dataTables_wrapper .dataTables_filter input {
                min-width: 220px;
            }

            .box.box-primary {
                border-top-color: #3c8dbc;
            }

            .dt-head-center thead th {
                text-align: center;
            }

            td pre {
                white-space: pre-wrap;
                margin: 0;
                font-family: inherit;
            }
        </style>
}

    <section class="content">
        <h2>Tevkifat Kod Listesi</h2>

        <div class="box box-primary">
            <div class="box-body">
                <table id="grid_Tevkifat" class="table table-bordered table-hover dataTable dt-head-center" width="100%">
                    <thead>
                        <tr>
                            <th style="width:20%">Tevkifat Kodu</th>
                            <th style="width:80%">Tevkifat Adı</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (Model != null && Model.Any())
                        {
                            foreach (var r in Model)
                            {
                                <tr>
                                    <td><pre>@(r.Code)</pre></td>
                                    <td><pre>@(r.Name)</pre></td>
                                </tr>
                            }
                        }
                        else
                        {
                            <!-- JS ile doldurulacak -->
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </section>

@section Scripts{
        <script>
            (function () {

                // Verdiğiniz liste: API gelmezse kullanılacak fallback
                var fallbackTevkifat = [
                    { code: 623, name: "Ağaç Ve Orman Ürünleri Teslimi" },
                    { code: 822, name: "Ağaç ve Orman Ürünleri Teslimi[KDVGUT-(I/C-2.1.3.3.6)]" },
                    { code: 619, name: "Bakir, Çinko Ve Alüminyum Ürünlerinin Teslimi" },
                    { code: 818, name: "Bakır, Çinko, Alüminyum ve Kurşun Ürünlerinin Teslimi[KDVGUT-(I/C-2.1.3.3.2)]" },
                    { code: 627, name: "Demir-Çelik Ürünlerinin Teslimi [Kdvgut-(I/C-2.1.3.3.8)]" },
                    { code: 825, name: "Demir-Çelik Ürünlerinin Teslimi [KDVGUT-(I/C-2.1.3.3.8)]" },
                    { code: 616, name: "Diğer Hizmetler [Kdvgut-(I/C-2.1.3.2.13)]" },
                    { code: 626, name: "Diğer Teslimler [Kdvgut-(I/C-2.1.3.3.7.)]" },
                    { code: 602, name: "Etüt, Plan-Proje, Danişmanlik, Denetim Ve Benzeri Hizmetler" },
                    { code: 802, name: "Etüt, Plan-Proje, Danışmanlık, Denetim ve Benzeri Hizmetler[KDVGUT-(I/C-2.1.3.2.2)]" },
                    { code: 609, name: "Fason Olarak Yaptirilan Tekstil Ve Konfeksiyon İşleri, Çanta Ve Ayakkabi Dikim İşleri Ve Bu İşlere Aracilik Hizmetleri" },
                    { code: 809, name: "Fason Olarak Yaptırılan Tekstil ve Konfeksiyon İşleri, Çanta ve Ayakkabı Dikim İşleri ve Bu İşlere Aracılık Hizmetleri[KDVGUT-(I/C-2.1.3.2.7)]" },
                    { code: 615, name: "Her Türlü Baski Ve Basim Hizmetleri" },
                    { code: 815, name: "Her Türlü Baskı ve Basım Hizmetleri[KDVGUT-(I/C-2.1.3.2.12)]" },
                    { code: 617, name: "Hurda Metalden Elde Edilen Külçe Teslimleri" },
                    { code: 816, name: "Hurda Metalden Elde Edilen Külçe Teslimleri[KDVGUT-(I/C-2.1.3.3.1)]" },
                    { code: 618, name: "Hurda Metalden Elde Edilenler Dişindaki Bakir, Çinko Demir ; Çelik Alüminyum Ve Kurşun Külçe Teslimleri [Kdvgut-(I/C-2.1.3.3.1)]" },
                    { code: 817, name: "Hurda Metalden Elde Edilenler Dışındaki Bakır, Çinko, Demir Çelik, Alüminyum ve Kurşun Külçe Teslimi [KDVGUT-(I/C-2.1.3.3.1)]" },
                    { code: 620, name: "İstisnadan Vazgeçenlerin Hurda Ve Atik Teslimi" },
                    { code: 819, name: "İstisnadan Vazgeçenlerin Hurda ve Atık Teslimi[KDVGUT-(I/C-2.1.3.3.3)]" },
                    { code: 606, name: "İşgücü Temin Hizmetleri" },
                    { code: 806, name: "İşgücü Temin Hizmetleri[KDVGUT-(I/C-2.1.3.2.5)]" },
                    { code: 603, name: "Makine, Teçhizat, Demirbaş Ve Taşitlara Ait Tadil, Bakim Ve Onarim Hizmetleri" },
                    { code: 803, name: "Makine, Teçhizat, Demirbaş ve Taşıtlara Ait Tadil, Bakım ve Onarım Hizmetleri[KDVGUT- (I/C-2.1.3.2.3)]" },
                    { code: 621, name: "Metal, Plastik, Lastik, Kauçuk, Kâğit Ve Cam Hurda Ve Atiklardan Elde Edilen Hammadde Teslimi" },
                    { code: 820, name: "Metal, Plastik, Lastik, Kauçuk, Kâğıt ve Cam Hurda ve Atıklardan Elde Edilen Hammadde Teslimi[KDVGUT-(I/C-2.1.3.3.4)]" },
                    { code: 605, name: "Organizasyon Hizmeti" },
                    { code: 805, name: "Organizasyon Hizmeti[KDVGUT-(I/C-2.1.3.2.4)]" },
                    { code: 622, name: "Pamuk, Tiftik, Yün Ve Yapaği İle Ham Post Ve Deri Teslimleri" },
                    { code: 821, name: "Pamuk, Tiftik, Yün ve Yapağı İle Ham Post ve Deri Teslimleri[KDVGUT-(I/C-2.1.3.3.5)]" },
                    { code: 614, name: "Servis Taşimaciliği Hizmeti" },
                    { code: 814, name: "Servis Taşımacılığı Hizmeti[KDVGUT-(I/C-2.1.3.2.11)]" },
                    { code: 611, name: "Spor Kulüplerinin Yayin, Reklâm Ve İsim Hakki Gelirlerine Konu İşlemleri" },
                    { code: 811, name: "Spor Kulüplerinin Yayın, Reklâm ve İsim Hakkı Gelirlerine Konu İşlemleri[KDVGUT-(I/C-2.1.3.2.9)]" },
                    { code: 612, name: "Temizlik Hizmeti" },
                    { code: 812, name: "Temizlik Hizmeti[KDVGUT-(I/C-2.1.3.2.10)]" },
                    { code: 625, name: "Ticari Reklam Hizmetleri [Kdvgut-(I/C-2.1.3.2.15)]" },
                    { code: 824, name: "Ticari Reklam Hizmetleri [KDVGUT-(I/C-2.1.3.2.15)]" },
                    { code: 610, name: "Turistik Mağazalara Verilen Müşteri Bulma / Götürme Hizmetleri" },
                    { code: 810, name: "Turistik Mağazalara Verilen Müşteri Bulma/ Götürme Hizmetleri[KDVGUT-(I/C-2.1.3.2.8)]" },
                    { code: 608, name: "Yapi Denetim Hizmetleri" },
                    { code: 601, name: "Yapim İşleri İle Bu İşlerle Birlikte İfa Edilen Mühendislik-Mimarlik Ve Etüt-Proje Hizmetleri" },
                    { code: 808, name: "Yapı Denetim Hizmetleri[KDVGUT-(I/C-2.1.3.2.6)]" },
                    { code: 801, name: "Yapım İşleri ile Bu İşlerle Birlikte İfa Edilen Mühendislik-Mimarlık ve Etüt-Proje Hizmetleri[KDVGUT-(I/C-2.1.3.2.1)]" },
                    { code: 604, name: "Yemek Servis Hizmeti" },
                    { code: 804, name: "Yemek Servis Hizmeti[KDVGUT-(I/C-2.1.3.2.4)]" },
                    { code: 624, name: "Yük Taşimaciliği Hizmeti [Kdvgut-(I/C-2.1.3.2.11)]" },
                    { code: 823, name: "Yük Taşımacılığı Hizmeti [KDVGUT-(I/C-2.1.3.2.11)]" },
                    { code: 613, name: "Çevre Ve Bahçe Bakim Hizmetleri" },
                    { code: 813, name: "Çevre ve Bahçe Bakım Hizmetleri[KDVGUT-(I/C-2.1.3.2.10)]" }
                ];

                function renderRows(rows) {
                    var $tbody = $('#grid_Tevkifat tbody');
                    $tbody.empty();
                    rows.forEach(function (r) {
                        var tr = '<tr>'
                            + '<td><pre>' + (r.code ?? r.Code) + '</pre></td>'
            + '<td><pre>' + (r.name ?? r.Name) + '</pre></td>'
                            + '</tr>';
                        $tbody.append(tr);
                    });
                }

                function initDataTable() {
                    var $tbl = $('#grid_Tevkifat');
                    if ($.fn.DataTable.isDataTable($tbl)) {
                        $tbl.DataTable().destroy();
                    }
                    $tbl.DataTable({
                        pageLength: 25,
                        order: [[0, 'asc']],
                        columnDefs: [{ targets: 0, type: 'num' }],
                        language: { url: '//cdn.datatables.net/plug-ins/1.13.6/i18n/tr.json' }
                    });
                }

                $(function () {
                    var hasServerRows = $('#grid_Tevkifat tbody tr').length > 0;

                    if (hasServerRows) {
                        initDataTable();
                        return;
                    }

                    // Önce API'den dene, olmazsa fallback
                    $.ajax({
                        url: '/api/tevkifat-kodlari', // Beklenen çıktı: [{ code, name }]
                        method: 'GET',
                        dataType: 'json',
                        timeout: 10000
                    }).done(function (data) {
                        if (Array.isArray(data) && data.length > 0) {
                            renderRows(data);
                        } else {
                            renderRows(fallbackTevkifat);
                        }
                    }).fail(function () {
                        renderRows(fallbackTevkifat);
                    }).always(function () {
                        initDataTable();
                    });
                });

            })();
        </script>
}
