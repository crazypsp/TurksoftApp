@{
    ViewData["Title"] = "e-Defter Yükle";
    ViewData["Subtitle"] = "e-Defter";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<section class="content-header">
    <h1>
        e-Defter
        <small>Yeni e-Defter Oluştur</small>
    </h1>
    <ol class="breadcrumb">
        <li><a asp-controller="Home" asp-action="Index"><i class="fa fa-home"></i></a> e-Defter</li>
        <li class="active">Yeni e-Defter Oluştur</li>
    </ol>
</section>

<section class="content">
    <h2>Yeni e-Defter Oluştur</h2>

    <div class="box box-default">
        <div class="box-body">
            <table id="gridELedgerUpload" class="table table-bordered table-hover dataTable dt-head-center">
                <thead>
                    <tr>
                        <th>Seçiniz</th>
                        <th>Şube No</th>
                        <th>Dönem Başlangıç Tarihi</th>
                        <th>Dönem Bitiş Tarihi</th>
                        <th>Yevmiye Madde Numarası Başlangıcı</th>
                        <th>Yevmiye Satırının Numara Başlangıcı</th>
                        <th>Müteselsil Numara Başlangıcı</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><input type="radio" name="radioBatchId" value="1"></td>
                        <td>1</td>
                        <td>01.01.2021</td>
                        <td>31.01.2021</td>
                        <td>1</td>
                        <td>1</td>
                        <td>1</td>
                    </tr>
                    <tr>
                        <td><input type="radio" name="radioBatchId" value="449"></td>
                        <td>449</td>
                        <td>01.01.2021</td>
                        <td>31.01.2021</td>
                        <td>1</td>
                        <td>1</td>
                        <td>1</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="box-body">
            <form id="defterCsvFileForm" enctype="multipart/form-data">
                <div class="form-group">
                    <label>Muhasebe programınızdan aldığınız Csv veya Json dosyasını yükleyiniz</label>
                    <input type="file" id="defterCsvFile" name="defterCsvFile" class="form-control" accept=".zip,.csv,.json" onchange="csvFileUpload(false)" />
                </div>
                <div class="form-group">
                    <label title="Dikkat! Son e-Defter parçasında bu alan işaretlenmemeli!">Parçalı dosya (zip/csv) yükleme işlemi</label>
                    <input type="checkbox" id="isHasNextFile" class="form-check-input" />
                </div>
            </form>

            <h3>Durum</h3>
            <div class="progress">
                <div id="uploadProgress" class="progress-bar progress-bar-success progress-bar-striped active" style="width:0%">
                    0%
                </div>
            </div>
            <label id="DurumIzlemeStatus"></label><br />
            <label id="DurumIzlemeMessage"></label><br />

            <button id="trySendingAgainGib" type="button" class="btn btn-info" onclick="trySendingAgainGib()" style="display:none;">GİB'e Göndermeyi Tekrar Dene</button>
            <button id="processDelete" type="button" class="btn btn-danger" onclick="processDelete()" style="display:none;">İptal Et</button>

            <div id="gridErrorDiv" hidden>
                <table id="gridErrorList" class="table table-bordered table-hover" style="color:red;">
                    <thead></thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <div class="box-body" id="DefterList" hidden>
            <h3>Dönem Bilgileri</h3>
            <div class="row">
                <div class="col-md-6">
                    <p><b>Dönem Başlangıç:</b> <span id="period_covered_start"></span></p>
                    <p><b>Dönem Bitiş:</b> <span id="period_covered_end"></span></p>
                    <p><b>Toplam Borç:</b> <span id="total_debit"></span></p>
                    <p><b>Toplam Alacak:</b> <span id="total_credit"></span></p>
                </div>
                <div class="col-md-6">
                    <p><b>Yevmiye Madde Başlangıcı:</b> <span id="entry_number_counter_start"></span></p>
                    <p><b>Yevmiye Madde Bitişi:</b> <span id="entry_number_counter_end"></span></p>
                    <p><b>Satır Başlangıcı:</b> <span id="line_number_start"></span></p>
                    <p><b>Satır Bitişi:</b> <span id="line_number_end"></span></p>
                </div>
            </div>

            <table id="gridDefterList" class="table table-bordered table-hover">
                <thead>
                    <tr><th>Dosya Adı</th><th>İşlem</th></tr>
                </thead>
                <tbody>
                    <tr>
                        <td></td>
                        <td>
                            <button class="btn btn-info btn-sm" title="Önizleme"><i class="glyphicon glyphicon-zoom-in"></i></button>
                            <button class="btn btn-success btn-sm" title="İndir"><i class="glyphicon glyphicon-download"></i></button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="box-body" id="DefterCounterSignatureList" hidden>
            <h3>GİB Onaylı Dosyalar</h3>
            <form id="gridDefterCounterSignatureForm" enctype="multipart/form-data">
                <table id="gridDefterCounterSignatureList" class="table table-bordered table-hover">
                    <thead>
                        <tr><th>Dosya Adı</th><th>İşlem</th></tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td></td>
                            <td>
                                <input type="file" accept=".zip" />
                                <button class="btn btn-success btn-sm"><i class="glyphicon glyphicon-download"></i></button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </form>
            <button type="button" class="btn btn-success" onclick="Process7111()">GİB Onaylı Dosyaları Yükle</button>
        </div>
    </div>
</section>

@section Scripts {
    <script>
        $(function () {
            $('#gridELedgerUpload, #gridDefterList, #gridDefterCounterSignatureList').DataTable({
                "language": { "url": "//cdn.datatables.net/plug-ins/1.10.21/i18n/Turkish.json" }
            });
        });

        function csvFileUpload(clear) {
            if (clear) $('#defterCsvFile').val('');
            else Swal.fire('Bilgi', 'Dosya yükleme işlemi başlatıldı.', 'info');
        }
        function trySendingAgainGib() { Swal.fire('Bilgi', 'GİB\'e gönderim tekrar denenecek.', 'info'); }
        function processDelete() { Swal.fire('Uyarı', 'İşlem iptal edildi.', 'warning'); }
        function Process7111() { Swal.fire('Bilgi', 'GİB onaylı dosyalar yükleniyor.', 'info'); }
    </script>
}
