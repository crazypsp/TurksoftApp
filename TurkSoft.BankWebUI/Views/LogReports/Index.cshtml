@{
    ViewData["Title"] = "Log Raporları";
    var transfer = (IEnumerable<TurkSoft.Entities.Entities.TransferLog>)ViewBag.TransferLogs;
    var system = (IEnumerable<TurkSoft.Entities.Entities.SystemLog>)ViewBag.SystemLogs;
}

<div class="row mb-3">
    <div class="col-12 d-flex gap-2 justify-content-end">
        <a class="btn btn-outline-primary btn-sm" href="@Url.Action("ExportTransferJson")">
            <i class="fa-solid fa-download me-1"></i>TransferLog JSON
        </a>
        <a class="btn btn-outline-secondary btn-sm" href="@Url.Action("ExportSystemJson")">
            <i class="fa-solid fa-download me-1"></i>SystemLog JSON
        </a>
    </div>
</div>

<div class="row g-3">
    <div class="col-12">
        <div class="card shadow border-0">
            <div class="card-header bg-white">
                <strong>Tiger Aktarım Logları</strong>
            </div>
            <div class="card-body table-responsive">
                <table id="transferLogTable" class="table table-striped table-hover w-100">
                    <thead>
                        <tr>
                            <th>Tarih</th>
                            <th>UserId</th>
                            <th>Status</th>
                            <th>UniqueKey</th>
                            <th>Amount</th>
                            <th>D/C</th>
                            <th>FicheRef</th>
                            <th>Error</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var x in transfer)
                        {
                            <tr>
                                <td>@x.CreatedDate.ToLocalTime().ToString("dd.MM.yyyy HH:mm")</td>
                                <td>@x.UserId</td>
                                <td>@x.Status</td>
                                <td style="max-width:220px;overflow:hidden;text-overflow:ellipsis;">@x.ExternalUniqueKey</td>
                                <td class="text-end">@x.Amount</td>
                                <td>@x.DebitCredit</td>
                                <td>@x.TigerFicheRef</td>
                                <td style="max-width:260px;overflow:hidden;text-overflow:ellipsis;">@x.ErrorMessage</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="col-12">
        <div class="card shadow border-0">
            <div class="card-header bg-white">
                <strong>Sistem Logları</strong>
            </div>
            <div class="card-body table-responsive">
                <table id="systemLogTable" class="table table-striped table-hover w-100">
                    <thead>
                        <tr>
                            <th>Tarih</th>
                            <th>Level</th>
                            <th>Source</th>
                            <th>Action</th>
                            <th>UserId</th>
                            <th>Message</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var x in system)
                        {
                            <tr>
                                <td>@x.CreatedDate.ToLocalTime().ToString("dd.MM.yyyy HH:mm")</td>
                                <td>@x.LogLevel</td>
                                <td>@x.Source</td>
                                <td>@x.ActionName</td>
                                <td>@x.UserId</td>
                                <td style="max-width:520px;overflow:hidden;text-overflow:ellipsis;">@x.Message</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $('#transferLogTable').DataTable({
            order: [[0,'desc']],
            pageLength: 25,
            language: { url: '//cdn.datatables.net/plug-ins/1.13.8/i18n/tr.json' }
        });

        $('#systemLogTable').DataTable({
            order: [[0,'desc']],
            pageLength: 25,
            language: { url: '//cdn.datatables.net/plug-ins/1.13.8/i18n/tr.json' }
        });
    </script>
}
